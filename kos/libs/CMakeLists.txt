add_subdirectory(replace)
add_subdirectory(talloc)
add_subdirectory(time-basic)
add_subdirectory(socket-blocking)
add_subdirectory(iov-buf)
add_subdirectory(samba-debug)
add_subdirectory(tevent)
add_subdirectory(genrand)
add_subdirectory(sys-rw)
add_subdirectory(util-setid)
add_subdirectory(roken)
add_subdirectory(samba-util)
add_subdirectory(samba-errors)
add_subdirectory(com-err)
add_subdirectory(ndr)
add_subdirectory(asn1)
add_subdirectory(tdb)
add_subdirectory(samba-security)
add_subdirectory(hcrypto)
add_subdirectory(wind)
add_subdirectory(ndr-nbt)
add_subdirectory(heimbase)
add_subdirectory(hx509)
add_subdirectory(tevent-util)
add_subdirectory(util-tdb)
add_subdirectory(tdb-wrap)
add_subdirectory(server-role)
add_subdirectory(ndr-standard)
add_subdirectory(krb5)
add_subdirectory(asn1util)
add_subdirectory(samba-hostconfig)
add_subdirectory(dbwrap)
add_subdirectory(gssapi)
add_subdirectory(msghdr)
add_subdirectory(interfaces)
add_subdirectory(events)
add_subdirectory(ndr-samba)
add_subdirectory(ldb)
add_subdirectory(krb5samba)
add_subdirectory(messages-dgm)
add_subdirectory(server-id-db)
add_subdirectory(messages-util)
add_subdirectory(cluster)
add_subdirectory(samba-sockets)
add_subdirectory(MESSAGING-SEND)
add_subdirectory(cli-ldap-common)
add_subdirectory(cliauth)
add_subdirectory(flag-mapping)
add_subdirectory(common-auth)
add_subdirectory(samdb-common)
add_subdirectory(ldbsamba)
add_subdirectory(authkrb5)
add_subdirectory(samba-credentials)
add_subdirectory(winbind-client)
add_subdirectory(wbclient)
add_subdirectory(samdb)
add_subdirectory(samba-modules)
add_subdirectory(samba3-util)
add_subdirectory(clidns)
add_subdirectory(gensec)
add_subdirectory(talloc-report-printf)
add_subdirectory(util-reg)
add_subdirectory(samba-cluster-support)
add_subdirectory(smbd-shim)
add_subdirectory(CHARSET3)
add_subdirectory(netif)
add_subdirectory(cli-nbt)
add_subdirectory(addns)
add_subdirectory(smbconf)
add_subdirectory(cli-ldap)
add_subdirectory(cli-cldap)
add_subdirectory(smb-transport)
add_subdirectory(secrets3)
add_subdirectory(cli-smb-common)
add_subdirectory(dcerpc-binding)
add_subdirectory(gse)
add_subdirectory(dcerpc-samba)
add_subdirectory(libsmb)
add_subdirectory(ndr-samba4)
add_subdirectory(msrpc3)
add_subdirectory(ndr-krb5pac)

add_subdirectory(smbd-base)
add_subdirectory(xattr-tdb)
add_subdirectory(printing-migrate)
add_subdirectory(npa-tstream)
add_subdirectory(netapi)
add_subdirectory(dcerpc-server-core)
add_subdirectory(cli-spoolss)
add_subdirectory(auth)
add_subdirectory(MESSAGING)
add_subdirectory(net-keytab)
add_subdirectory(ads)
add_subdirectory(dcerpc)
add_subdirectory(libcli-lsa3)
add_subdirectory(trusts-util)
add_subdirectory(http)
add_subdirectory(smbclient-raw)
add_subdirectory(dcerpc-pkt-auth)
add_subdirectory(libcli-netlogon3)
add_subdirectory(samba-passdb)

add_subdirectory(gnutls)
add_subdirectory(resolv)
add_subdirectory(bsd)

set(C_LIB ${CMAKE_ARCHIVE_OUTPUT_DIRECTORY}/libcombi.a)

add_custom_target(combined
        COMMAND rm -f ${C_LIB}
        COMMAND ar crsT ${C_LIB} *.a
        WORKING_DIRECTORY ${CMAKE_ARCHIVE_OUTPUT_DIRECTORY}
        DEPENDS replace talloc time-basic socket-blocking iov-buf samba-debug tevent genrand sys-rw util-setid roken samba-util samba-errors com-err ndr asn1 tdb samba-security hcrypto wind ndr-nbt heimbase hx509 tevent-util util-tdb tdb-wrap server-role ndr-standard krb5 asn1util samba-hostconfig dbwrap gssapi msghdr interfaces events ndr-samba ldb krb5samba messages-dgm server-id-db messages-util cluster samba-sockets MESSAGING-SEND cli-ldap-common cliauth flag-mapping common-auth samdb-common ldbsamba authkrb5 samba-credentials winbind-client wbclient samdb samba-modules samba3-util clidns gensec talloc-report-printf util-reg samba-cluster-support smbd-shim CHARSET3 netif cli-nbt addns smbconf cli-ldap cli-cldap smb-transport secrets3 cli-smb-common dcerpc-binding gse dcerpc-samba libsmb ndr-samba4 msrpc3 ndr-krb5pac gnutls smbd-base xattr-tdb printing-migrate npa-tstream netapi dcerpc-server-core cli-spoolss auth MESSAGING net-keytab ads dcerpc libcli-lsa3 trusts-util http smbclient-raw dcerpc-pkt-auth libcli-netlogon3 samba-passdb bsd resolv
)

add_library(c STATIC IMPORTED GLOBAL)
add_dependencies(c combined)

set_target_properties(c
        PROPERTIES
        IMPORTED_LOCATION ${C_LIB}
)

set(SAMBA_EXT_MODULES
        c
        PARENT_SCOPE
)

set(SAMBA_THIRD_PARTY_LIBS
        pthread
        dl
        ssl
        crypto
        z
        PARENT_SCOPE
)
