set(TARGET_NAME gensec)

set(TARGET_SRC
        ${SMB_SRC_ROOT}/source4/auth/gensec/gensec_tstream.c
        ${SMB_SRC_ROOT}/auth/ntlmssp/gensec_ntlmssp.c
        ${SMB_SRC_ROOT}/auth/ntlmssp/ntlmssp.c
        ${SMB_SRC_ROOT}/auth/ntlmssp/ntlmssp_util.c
        ${SMB_SRC_ROOT}/auth/ntlmssp/ntlmssp_ndr.c
        ${SMB_SRC_ROOT}/auth/ntlmssp/ntlmssp_client.c
        ${SMB_SRC_ROOT}/auth/ntlmssp/ntlmssp_server.c
        ${SMB_SRC_ROOT}/auth/ntlmssp/ntlmssp_sign.c
        ${SMB_SRC_ROOT}/auth/ntlmssp/gensec_ntlmssp_server.c
        ${SMB_SRC_ROOT}/auth/gensec/schannel.c
        ${SMB_SRC_ROOT}/libcli/http/gensec/generic.c
        ${SMB_SRC_ROOT}/auth/gensec/ncalrpc.c
        ${SMB_SRC_ROOT}/libcli/http/gensec/basic.c
        ${SMB_SRC_ROOT}/auth/gensec/spnego.c
        ${SMB_SRC_ROOT}/auth/gensec/gensec.c
        ${SMB_SRC_ROOT}/auth/gensec/gensec_start.c
        ${SMB_SRC_ROOT}/auth/gensec/gensec_util.c
        ${SMB_SRC_ROOT}/bin/default/auth/ntlmssp/gensec_ntlmssp.empty.c
        ${SMB_SRC_ROOT}/auth/gensec/external.c
        ${SMB_SRC_ROOT}/source4/auth/gensec/gensec_gssapi.c
)

add_library(
        ${TARGET_NAME}
        STATIC
        ${TARGET_SRC}
)

target_include_directories(
        ${TARGET_NAME}
        PRIVATE
        ${SMB_SRC_ROOT}
        ${SMB_SRC_ROOT}/lib
        ${SMB_SRC_ROOT}/lib/tsocket
        ${SMB_SRC_ROOT}/lib/replace
        ${SMB_SRC_ROOT}/lib/talloc
        ${SMB_SRC_ROOT}/lib/tevent
        ${SMB_SRC_ROOT}/lib/ldb-samba
        ${SMB_SRC_ROOT}/lib/ldb/include
        ${SMB_SRC_ROOT}/lib/tdb/include
        ${SMB_SRC_ROOT}/include
        ${SMB_SRC_ROOT}/include/public
        ${SMB_SRC_ROOT}/source3
        ${SMB_SRC_ROOT}/source3/include
        ${SMB_SRC_ROOT}/source3/lib
        ${SMB_SRC_ROOT}/source4
        ${SMB_SRC_ROOT}/source4/lib
        ${SMB_SRC_ROOT}/source4/include
        ${SMB_SRC_ROOT}/source4/heimdal_build
        ${SMB_SRC_ROOT}/source4/heimdal_build/include
        ${SMB_SRC_ROOT}/source4/heimdal/lib
        ${SMB_SRC_ROOT}/source4/heimdal/base
        ${SMB_SRC_ROOT}/source4/heimdal/lib/krb5
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken
        ${SMB_SRC_ROOT}/source4/heimdal/lib/com_err
        ${SMB_SRC_ROOT}/source4/heimdal/lib/asn1
        ${SMB_SRC_ROOT}/source4/heimdal/lib/wind
        ${SMB_SRC_ROOT}/source4/heimdal/lib/hx509
        ${SMB_SRC_ROOT}/source4/heimdal/lib/gssapi
        ${SMB_SRC_ROOT}/source4/heimdal/lib/gssapi/gssapi
        ${SMB_SRC_ROOT}/source4/heimdal/lib/gssapi/mech
        ${SMB_SRC_ROOT}/source4/heimdal/lib/hcrypto
        ${SMB_SRC_ROOT}/source4/heimdal/lib/hcrypto/libtommath
        ${SMB_SRC_ROOT}/source4/heimdal/include
        ${SMB_SRC_ROOT}/third_party/gpfs
        ${SMB_SRC_ROOT}/bin/default
        ${SMB_SRC_ROOT}/bin/default/include
        ${SMB_SRC_ROOT}/bin/default/lib/ldb/include
        ${SMB_SRC_ROOT}/bin/default/librpc/
        ${SMB_SRC_ROOT}/bin/default/source4
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/lib/asn1
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/lib/wind
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/lib/hx509
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/lib/krb5
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/lib/gssapi
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/lib/gssapi/spnego
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/lib/gssapi/krb5
)

target_compile_definitions(
        ${TARGET_NAME}
        PRIVATE
        _SAMBA_BUILD_=4
        HAVE_CONFIG_H=1
        _GNU_SOURCE=1
        _XOPEN_SOURCE_EXTENDED=1
        __STDC_WANT_LIB_EXT1__=1
        _REENTRANT
        STATIC_gensec_util_MODULES=NULL
        "STATIC_gensec_util_MODULES_PROTO=extern void __gensec_util_dummy_module_proto(void)"
        STATIC_NTLMSSP_COMMON_MODULES=NULL
        "STATIC_NTLMSSP_COMMON_MODULES_PROTO=extern void __NTLMSSP_COMMON_dummy_module_proto(void)"
        STATIC_gensec_schannel_MODULES=NULL
        "STATIC_gensec_schannel_MODULES_PROTO=extern void __gensec_schannel_dummy_module_proto(void)"
        STATIC_gensec_http_generic_MODULES=NULL
        "STATIC_gensec_http_generic_MODULES_PROTO=extern void __gensec_http_generic_dummy_module_proto(void)"
        STATIC_gensec_ncalrpc_MODULES=NULL
        "STATIC_gensec_ncalrpc_MODULES_PROTO=extern void __gensec_ncalrpc_dummy_module_proto(void)"
        STATIC_gensec_http_basic_MODULES=NULL
        "STATIC_gensec_http_basic_MODULES_PROTO=extern void __gensec_http_basic_dummy_module_proto(void)"
        STATIC_gensec_spnego_MODULES=NULL
        "STATIC_gensec_spnego_MODULES_PROTO=extern void __gensec_spnego_dummy_module_proto(void)"
        "STATIC_gensec_MODULES=gensec_gssapi_init,gensec_spnego_init,gensec_schannel_init,gensec_ncalrpc_as_system_init,gensec_external_init,gensec_ntlmssp_init,gensec_http_basic_init,gensec_http_generic_init,NULL"
        "STATIC_gensec_MODULES_PROTO=_MODULE_PROTO(gensec_gssapi_init)_MODULE_PROTO(gensec_spnego_init)_MODULE_PROTO(gensec_schannel_init)_MODULE_PROTO(gensec_ncalrpc_as_system_init)_MODULE_PROTO(gensec_external_init)_MODULE_PROTO(gensec_ntlmssp_init)_MODULE_PROTO(gensec_http_basic_init)_MODULE_PROTO(gensec_http_generic_init)extern void __gensec_dummy_module_proto(void)"
        STATIC_gensec_ntlmssp_MODULES=NULL
        "STATIC_gensec_ntlmssp_MODULES_PROTO=extern void __gensec_ntlmssp_dummy_module_proto(void)"
        STATIC_gensec_external_MODULES=NULL
        "STATIC_gensec_external_MODULES_PROTO=extern void __gensec_external_dummy_module_proto(void)"
        STATIC_gensec_gssapi_MODULES=NULL
        "STATIC_gensec_gssapi_MODULES_PROTO=extern void __gensec_gssapi_dummy_module_proto(void)"
)

target_compile_options(
        ${TARGET_NAME}
        PRIVATE
        -MMD
        -fPIC
        -fstack-protector-strong
        -fstack-clash-protection
)
