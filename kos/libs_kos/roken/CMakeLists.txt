set(TARGET_NAME roken)

set(TARGET_SRC
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/base64.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/ct.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/hex.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/bswap.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/dumpdata.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/emalloc.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/ecalloc.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/getarg.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/get_window_size.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/getdtablesize.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/h_errno.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/issuid.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/net_read.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/net_write.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/parse_time.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/parse_units.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/vis.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/strlwr.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/strsep_copy.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/strsep.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/strupr.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/strpool.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/estrdup.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/erealloc.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/simple_exec.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/strcollect.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/rtbl.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/rand.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/cloexec.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/xfree.c
        ${SMB_SRC_ROOT}/source4/heimdal_build/replace.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/resolve.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/socket.c
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken/roken_gethostby.c
        )

add_library(
        ${TARGET_NAME}
        STATIC
        ${TARGET_SRC}
)

target_include_directories(
        ${TARGET_NAME}
        PRIVATE
        ${SMB_SRC_ROOT}/source4/heimdal_build
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal_build
        ${SMB_SRC_ROOT}/source4/heimdal/lib/roken
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/lib/roken
        ${SMB_SRC_ROOT}/source4/heimdal/include
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal/include
        ${SMB_SRC_ROOT}/source4/heimdal_build/include
        ${SMB_SRC_ROOT}/bin/default/source4/heimdal_build/include
        ${SMB_SRC_ROOT}/include/public
        ${SMB_SRC_ROOT}/bin/default/include/public
        ${SMB_SRC_ROOT}/source4
        ${SMB_SRC_ROOT}/bin/default/source4
        ${SMB_SRC_ROOT}/lib
        ${SMB_SRC_ROOT}/bin/default/lib
        ${SMB_SRC_ROOT}/source4/lib
        ${SMB_SRC_ROOT}/bin/default/source4/lib
        ${SMB_SRC_ROOT}/source4/include
        ${SMB_SRC_ROOT}/bin/default/source4/include
        ${SMB_SRC_ROOT}/include
        ${SMB_SRC_ROOT}/bin/default/include
        ${SMB_SRC_ROOT}/lib/replace
        ${SMB_SRC_ROOT}/bin/default/lib/replace
        ${SMB_SRC_ROOT}/.
        ${SMB_SRC_ROOT}/bin/default/
)

target_compile_definitions(
        ${TARGET_NAME}
        PRIVATE
        _SAMBA_BUILD_=4
        HAVE_CONFIG_H=1
        _GNU_SOURCE=1
        _XOPEN_SOURCE_EXTENDED=1
        __STDC_WANT_LIB_EXT1__=1
        _REENTRANT
        _POSIX_PTHREAD_SEMANTICS
        STATIC_roken_MODULES=NULL
        "STATIC_roken_MODULES_PROTO=extern void __roken_dummy_module_proto(void)"
)

target_compile_options(
        ${TARGET_NAME}
        PRIVATE
        -MMD
        -fPIC
        -fstack-protector-strong
        -fstack-clash-protection
        -Wno-error=discarded-qualifiers
        -Wno-error=cast-qual
        -Wno-error=missing-field-initializers
        -Wno-error=shadow
        -Wno-error=implicit-fallthrough
        -Wno-error=enum-compare
        -Wno-error=unused-but-set-variable
        -Wno-error=unused-const-variable
        -Wno-error=unused-variable
        -Wno-error=unused-result
)
